{
    "i18n": true,
    "type": "tabs",
    "items": {
        "tabCanAdapter": {
            "type": "panel",
            "label": "CAN Adapter",
            "items": {
                "introTabCanInstanceNotActiveTxt": {
                    "type": "staticText",
                    "text": "Please start this adapter instance to enable further configuration options.",
                    "newLine": true,
                    "hidden": "_alive",
                    "style": {
                        "color": "red"
                    }
                },
                "introTabCanPressSaveTxt": {
                    "type": "staticText",
                    "text": "Please press button 'Save', when you're done on this tab.",
                    "newLine": true,
                    "hidden": "!_changed",
                    "style": {
                        "color": "red"
                    }
                },
                "canExtHeader": {
                    "type": "header",
                    "text": "External CAN Adapter",
                    "size": 2,
                    "newLine": true
                },
                "canExtName": {
                    "type": "text",
                    "tooltip": "Device mame of CAN adapter connected to external bus, e.g. can0",
                    "default" : "vcan0",
                    "newLine": false
                },
                "canExtActivated": {
                    "type": "checkbox",
                    "label": "Connect to Adapter",
                    "tooltip": "Check, if this adapter shall be used.",
                    "default" : false,
                    "newLine": false
                },        
                "canIntHeader": {
                    "type": "header",
                    "text": "Internal CAN Adapter",
                    "size": 2,
                    "newLine": true
                },
                "canIntName": {
                    "type": "text",
                    "tooltip": "Device mame of CAN adapter connected to internal bus, e.g. can1",
                    "default" : "vcan1",
                    "newLine": false
                },
               "canIntActivated": {
                    "type": "checkbox",
                    "label": "Connect to Adapter",
                    "tooltip": "Check, if this adapter shall be used.",
                    "default" : false,
                    "newLine": false
                }        
            }
        },
        "tabUdsDevices": {
            "type": "panel",
            "label": "List of UDS devices",
            "hidden": "if (!data.canExtActivated) { return true; } else {return false; }",
            "items": {
                "tableUdsDevicesHdr": {
                    "type": "header",
                    "text": "List of available devices",
                    "size": 2
                },

                "tableUdsDevicesWarning": {
                    "type": "staticText",
                    "text": "Configuration requires a running adapter instance!",
                    "hidden": "_alive",
                    "newLine": true,
                    "style": {
                        "color": "red"
                    }
                },
                "introTabUdsDevicesSaveTxt": {
                    "type": "staticText",
                    "text": "Please press button 'Save', when you're done on this tab.",
                    "newLine": true,
                    "hidden": "!_changed",
                    "style": {
                        "color": "red"
                    }
                },
                "introtableUdsDevicesTxt": {
                    "type": "staticText",
                    "text": "You may edit 2nd column to set name of state for the device (visible in object tree).",
                    "hidden": "if ((data.tableUdsDevices) && (data.tableUdsDevices.length > 0)) { return true; } else {return false; }",
                    "newLine": true
                },
                "introTableScanIsActiveTxt": {
                    "type": "staticText",
                    "text": "UDS device scan is ongoing. This may take up to 20 seconds.",
                    "newLine": true,
                    "hidden": "if ((data.tableUdsDevices) && (data.tableUdsDevices.length > 0)) { return true; } else {return false; }",
                    "style": {
                        "color": "red"
                    }
                },
                "introTableNoEmptyDevNameTxt": {
                    "type": "staticText",
                    "text": "'Device state name' must not be blank!",
                    "newLine": true,
                    "hidden": "if ( (data.tableUdsDevices) && (data.tableUdsDevices.length > 0) ) {for (const c of data.tableUdsDevices) {if (c.devStateName === '') return false;}; return true;} else return true;",
                    "style": {
                        "color": "red"
                    }
                },
                "introTableNoDotInDevNameTxt": {
                    "type": "staticText",
                    "text": "Symbol '.' not allowed in 'Device state name'!",
                    "newLine": true,
                    "hidden": "if ( (data.tableUdsDevices) && (data.tableUdsDevices.length > 0) ) {for (const c of data.tableUdsDevices) {if (c.devStateName.includes('.')) return false;}; return true;} else return true;",
                    "style": {
                        "color": "red"
                    }
                },

                "tableUdsDevices": {
                    "type": "table",
                    "defaultSendTo": "getUdsDevices",
                    "jsonData": "${JSON.stringify(data.tableUdsDevices)}",
                    "uniqueColumns": ["devStateName"],
                    "newLine": true,
                    "sm": 12,
                    "md": 12,
                    "lg": 12,
                    "label": "List of available devices",
                    "hidden": "!_alive",
                    "noDelete": true,
                    "import": true,
                    "export": true,
                    "items": [
                        {
                            "type": "text",
                            "attr": "devName",
                            "width": "15% ",
                            "title": "Device name (Viessmann)",
                            "tooltip": "Device ECU name (fixed)",
                            "filter": false,
                            "sort": false,
                            "readOnly": true
                        },
                        {
                            "type": "text",
                            "attr": "devStateName",
                            "width": "15% ",
                            "title": "Device state name",
                            "tooltip": "Device name in object tree. Must not contain dots.",
                            "filter": false,
                            "sort": false,
                            "validator": "if ( (data.devStateName === '') || (data.devStateName.includes('.')) ) { return false; } else { return true; }",
                            "validatorNoSaveOnError": true
                        },
                        {
                            "type": "text",
                            "attr": "devAddr",
                            "width": "10% ",
                            "title": "Device Address",
                            "tooltip": "Device ECU address (fixed)",
                            "filter": false,
                            "sort": false,
                            "readOnly": true
                        },
                        {
                            "type": "text",
                            "attr": "collectCanId",
                            "width": "10% ",
                            "title": "CAN id for collecting data",
                            "tooltip": "CAN id - still experimental. Leave blank for deactivation.",
                            "filter": false,
                            "sort": false,
                            "readOnly": false
                        }
                    ]
                }
            }
        },
        "tabUdsDids": {
            "type": "panel",
            "label": "List of datapoints",
            "hidden": "if ((data.tableUdsDevices) && (data.tableUdsDevices.length == 0)) { return true; } else {return false; }",
            "items": {
                "tableUdsDidsWarning": {
                    "type": "staticText",
                    "text": "Configuration requires a running adapter instance!",
                    "hidden": "_alive",
                    "newLine": true,
                    "style": {
                        "color": "red"
                    }
                },
                "tableUdsDidsStartScan": {
                    "type": "sendTo",
                    "label": "Start scan for datapoints of all devices",
                    "variant": "outlined",
                    "showProcess": true,
                    "style": {
                        "align": "right"
                    },
                    "jsonData": "{}",
                    "command": "startDidScan",
                    "confirm": {
                        "condition": "true",
                        "title": "Confirm scan for datapoints",
                        "text": "Scan will take up to 5 minutes. Plaese make sure, no other UDSonCAN client (e.g. Open3Eclient.py) is running. Please do not close the tab during scan. You may follow up the progress by watching the Log in an additional tab.",
                        "ok": "OK",
                        "cancel": "Cancel"
                    },
                    "hidden": "!_alive",
                    "newLine": true
                },
                "tableUdsDidsSelDev": {
                    "type": "selectSendTo",
                    "label": "Select device",
                    "jsonData": "{}",
                    "command": "getUdsDidsDevSelect",
                    "sm": 8,
                    "md": 6,
                    "lg": 4,
                    "default": "Select device",
                    "hidden": "!_alive",
                    "alsoDependsOn": ["udsSchedule","tableUdsDevices"],
                    "newLine": true
                },

                "tableUdsDids": {
                    "type": "table",
                    "defaultSendTo": "getUdsDids",
                    "jsonData": "${JSON.stringify(data.tableUdsDidsSelDev)}",
                    "button": "Update",
                    "showProcess": true,
                    "newLine": true,
                    "doNotSave": true,
                    "sm": 12,
                    "md": 12,
                    "lg": 12,
                    "label": "List of device specific datapoints",
                    "onChange": {"alsoDependsOn": ["tableUdsDidsSelDev"], "calculateFunc": "", "ignoreOwnChanges": false},
                    "hidden": "if ( (_alive) && (data.tableUdsDidsSelDev) && (data.tableUdsDidsSelDev != 'Select device') ) { return false; }; return true;",
                    "noDelete": true,
                    "import": true,
                    "export": true,
                    "items": [
                        {
                            "type": "number",
                            "attr": "didId",
                            "doNotSave": true,
                            "width": "10% ",
                            "title": "ID",
                            "tooltip": "Did id",
                            "filter": false,
                            "sort": false
                        },
                        {
                            "type": "number",
                            "attr": "didLen",
                            "doNotSave": true,
                            "width": "10% ",
                            "title": "Length",
                            "tooltip": "Did length",
                            "filter": false,
                            "sort": false
                        },
                        {
                            "type": "text",
                            "attr": "didName",
                            "doNotSave": true,
                            "width": "55% ",
                            "title": "Name",
                            "tooltip": "Name of did",
                            "filter": true,
                            "sort": false,
                            "readOnly": true
                        },
                        {
                            "type": "text",
                            "attr": "didCodec",
                            "doNotSave": true,
                            "width": "25% ",
                            "title": "Codec",
                            "tooltip": "Codec used for did",
                            "filter": true,
                            "sort": false,
                            "readOnly": true
                        }
                   ]
                }
            }
        },
        "tabCanAdapterExt": {
            "type": "panel",
            "label": "Assignments to External CAN Adapter",
            "hidden": "if ((data.tableUdsDevices) && (data.tableUdsDevices.length == 0)) { return true; } else {return false; }",
            "items": {
                "tableCanAdapterExtWarning": {
                    "type": "staticText",
                    "text": "Configuration requires a running adapter instance!",
                    "hidden": "_alive",
                    "newLine": true,
                    "style": {
                        "color": "red"
                    }
                },
                "e380Header": {
                    "type": "header",
                    "text": "Energy Meter E380",
                    "size": 2,
                    "newLine": true
                },
                "e380WarnUpdateTime": {
                    "type": "staticText",
                    "text": "WARNING: Values below 2 seconds may cause heavy system load!",
                    "newLine": true,
                    "hidden": "if (data.e380Delay < 2) { return false; }; return true;",
                    "style": {
                        "color": "red"
                    }
                },
                "e380Active": {
                    "type": "checkbox",
                    "label": "active",
                    "tooltip": "Activate communication",
                    "default" : false,
                    "newLine": true
                },
                "e380Name": {
                    "type": "text",
                    "label": "Device state name",
                    "tooltip": "This text will be used as base for object tree",
                    "default" : "e380",
                    "newLine": false
                },
                "e380Delay": {
                    "type": "number",
                    "label": "Min. update time (s)",
                    "tooltip": "Minumum update time for states. 0 for immediate update.",
                    "default" : 5,
                    "min": 0,
                    "newLine": false
                },
                "tableHdrCol": {
                    "type": "header",
                    "text": "Collecting Data on External CAN Adapter",
                    "size": 2
                },

                "introTableColExt": {
                    "type": "staticText",
                    "text": "Listen for data on addresses given in this table. No writing to CAN bus. Press '+' to begin.",
                    "hidden": "if (data.tableUdsDevices) {for(let i=0; i<data.tableUdsDevices.length; i++){if (data.tableUdsDevices[i].collectCanId != '') return false;}; return true;} else {return true;}",
                    "newLine": true
                },

                "introTableColExtNoDevs": {
                    "type": "staticText",
                    "text": "No device for collecting available (missing CAN ID).",
                    "hidden": "if (data.tableUdsDevices) {for(let i=0; i<data.tableUdsDevices.length; i++){if (data.tableUdsDevices[i].collectCanId != '') return true;}; return false;} else {return false;}",
                    "newLine": true
                },

                "tableColExtErrDevName": {
                    "type": "staticText",
                    "text": "ERROR: column 'Device state name' must contain unique text",
                    "newLine": true,
                    "hidden": "const x={}; for(let ii=0; data.tableCollectCanExt && ii<data.tableCollectCanExt.length; ii++){const t=data.tableCollectCanExt[ii].collectCanId; if (x[t]==='x') return false; x[t]='x';}; return true;",
                    "style": {
                        "color": "red"
                    }
                },

                "tableCollectCanExt": {
                    "type": "table",
                    "newLine": true,
                    "sm": 12,
                    "md": 12,
                    "lg": 12,
                    "label": "",
                    "hidden": "if (data.tableUdsDevices) {for(let i=0; i<data.tableUdsDevices.length; i++){if (data.tableUdsDevices[i].collectCanId != '') return false;}; return true;} else {return true;}",
                    "showSecondAddAt": 5,
                    "items": [
                        {
                            "type": "checkbox",
                            "attr": "collectActive",
                            "width": "5% ",
                            "title": "active",
                            "tooltip": "Activate communication",
                            "filter": false,
                            "sort": false,
                            "default": true
                        },
                        {   "type": "selectSendTo",
                            "title": "Select device",
                            "command": "getExtColDeviceSelect",
                            "attr": "collectCanId",
                            "jsonData": "${JSON.stringify(globalData.tableUdsDevices)}",
                            "width": "15%",
                            "default": "Select device",
                            "alsoDependsOn": ["collectActive","tableUdsDevices"],
                            "newLine": false,
                            "validator": "if (data.collectCanId === 'Select device') { return false; } else { return true; }",
                            "validatorNoSaveOnError": true
                        },
                        {
                            "type": "number",
                            "attr": "collectDelayTime",
                            "width": "15% ",
                            "title": "Min. update time (s)",
                            "tooltip": "Minumum update time for states. 0 for immediate update.",
                            "filter": false,
                            "sort": false,
                            "min": 0,
                            "step": 1,
                            "default": 5
                        }
                    ]
                },
                "tableHdrUds": {
                    "type": "header",
                    "text": "Requesting data on external CAN Adapter via UDSonCAN",
                    "size": 2
                },

                "introTableUds": {
                    "type": "staticText",
                    "text": "Specify schedules for devices, press '+' to begin.",
                    "newLine": true
                },
                "tableUdsSchedules": {
                    "type": "table",
                    "newLine": true,
                    "sm": 12,
                    "md": 12,
                    "lg": 12,
                    "label": "",
                    "showSecondAddAt": 5,
                    "items": [
                        {
                            "type": "checkbox",
                            "attr": "udsScheduleActive",
                            "width": "5% ",
                            "title": "active",
                            "tooltip": "Activate communication",
                            "filter": false,
                            "sort": false,
                            "default": true
                        },
                        {
                            "type": "number",
                            "attr": "udsSchedule",
                            "width": "10% ",
                            "title": "Schedule (s)",
                            "tooltip": "Schedule for requesting given DIDs. 0 for one time request on start of adapter instance.",
                            "filter": false,
                            "sort": false,
                            "min": 0,
                            "step": 1,
                            "default": 0
                        },
                        {   "type": "selectSendTo",
                            "title": "Select device",
                            "command": "getUdsDeviceSelect",
                            "attr": "udsSelectDevAddr",
                            "jsonData": "${JSON.stringify(globalData.tableUdsDevices)}",
                            "width": "15%",
                            "default": "Select device",
                            "alsoDependsOn": ["udsSchedule","tableUdsDevices"],
                            "newLine": false,
                            "validator": "if (data.udsSelectDevAddr === 'Select device') { return false; } else { return true; }",
                            "validatorNoSaveOnError": true
                        },
                        {
                            "type": "text",
                            "attr": "udsScheduleDids",
                            "width": "30% ",
                            "title": "List of DIDs",
                            "tooltip": "Separate by comma! All given DIDs will be requested with specified schedule an ECU address.",
                            "filter": false,
                            "sort": false,
                            "default": "256"
                        }
                    ]
                }

            }
        },
        "tabCanAdapterInt": {
            "type": "panel",
            "label": "Assignments to Internal CAN Adapter",
            "hidden": "return !data.canIntActivated;",
            "items": {
                "tableHdr": {
                    "type": "header",
                    "text": "Collecting Data on Internal CAN Adapter",
                    "size": 2
                },

                "introTableColInt": {
                    "type": "staticText",
                    "text": "Listen for data on addresses given in this table. No writing to CAN bus.",
                    "newLine": true
                },

                "tableCanAdapterIntWarning": {
                    "type": "staticText",
                    "text": "Configuration requires a running adapter instance!",
                    "hidden": "_alive",
                    "newLine": true,
                    "style": {
                        "color": "red"
                    }
                },
                "tableColIntErrDevName": {
                    "type": "staticText",
                    "text": "ERROR: column 'Device state name' must contain unique text",
                    "newLine": true,
                    "hidden": "const x={}; for(let ii=0; data.tableCollectCanInt && ii<data.tableCollectCanInt.length; ii++){const t=data.tableCollectCanInt[ii].collectCanId; if (x[t]==='x') return false; x[t]='x';}; return true;",
                    "style": {
                        "color": "red"
                    }
                },
                "tableCollectCanInt": {
                    "type": "table",
                    "newLine": true,
                    "sm": 12,
                    "md": 12,
                    "lg": 12,
                    "label": "",
                    "showSecondAddAt": 5,

                    "items": [
                        {
                            "type": "checkbox",
                            "attr": "collectActive",
                            "width": "5% ",
                            "title": "active",
                            "tooltip": "Activate communication",
                            "filter": false,
                            "sort": false,
                            "default": false
                        },
                        {   "type": "selectSendTo",
                            "title": "Select device",
                            "command": "getIntColDeviceSelect",
                            "attr": "collectCanId",
                            "jsonData": "${JSON.stringify(globalData.tableUdsDevices)}",
                            "width": "15%",
                            "default": "Select device",
                            "alsoDependsOn": ["collectActive","tableUdsDevices"],
                            "newLine": false,
                            "validator": "if (data.collectCanId === 'Select device') { return false; } else { return true; }",
                            "validatorNoSaveOnError": true
                        },
                        {
                            "type": "number",
                            "attr": "collectDelayTime",
                            "width": "15% ",
                            "title": "Min. update time (s)",
                            "tooltip": "Minumum update time for states. 0 for immediate update.",
                            "filter": false,
                            "sort": false,
                            "min": 0,
                            "step": 1,
                            "default": 5
                        }
                    ]
                }
            }
        }
    }
}